<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>å‹‹ç« é¦† - å„¿ç«¥å¼€æ™ºå°æ¸¸æˆ</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='kids.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='achievements.css') }}">
  <meta name="color-scheme" content="light dark">
</head>
<body class="achievements-page">
  <div class="ach-header">
    <a href="/" class="ach-back">â† è¿”å›æ£®æ—ï¼ˆé¦–é¡µï¼‰</a>
    <h1 class="ach-title">å‹‹ç« é¦†</h1>
  </div>
  <div class="ach-panel glass-panel">
    <p class="ach-desc">æ”¶é›†å‹‹ç« ï¼Œæˆä¸ºæ£®æ—é‡Œæœ€æ£’çš„å°å‹‡å£«ï¼</p>
    <div class="ach-grid" id="achGrid"></div>
  </div>
  <div id="achDetailModal" class="ach-modal" aria-hidden="true">
    <div class="ach-modal-overlay"></div>
    <div class="ach-modal-box">
      <p class="ach-modal-rarity" id="achDetailRarity"></p>
      <p class="ach-modal-date" id="achDetailDate"></p>
      <p class="ach-modal-msg" id="achDetailMsg"></p>
      <button type="button" class="ach-modal-btn" id="achDetailClose">çŸ¥é“äº†</button>
    </div>
  </div>
  <script>
    (function() {
      const grid = document.getElementById("achGrid");
      const modal = document.getElementById("achDetailModal");
      const rarityEl = document.getElementById("achDetailRarity");
      const dateEl = document.getElementById("achDetailDate");
      const msgEl = document.getElementById("achDetailMsg");
      const closeBtn = document.getElementById("achDetailClose");
      const medalList = [
        { key: "first_single", name: "åˆå‡ºèŒ…åº", emoji: "ğŸ…", rarity: "æ™®é€š", effect: "" },
        { key: "vs_3_wins", name: "å¯¹æˆ˜å…ˆé”‹", emoji: "ğŸ†", rarity: "æ™®é€š", effect: "" },
        { key: "play_50", name: "ç™¾æŠ˜ä¸æŒ ", emoji: "ğŸ–ï¸", rarity: "æ™®é€š", effect: "" },
        { key: "seq_master", name: "è®°å¿†å°èƒ½æ‰‹", emoji: "ğŸŒŸ", rarity: "æ™®é€š", effect: "" },
        { key: "vs_master", name: "å¯¹æˆ˜è¾¾äºº", emoji: "ğŸ’", rarity: "æ™®é€š", effect: "" },
        { key: "forest_regular", name: "æ£®æ—å¸¸å®¢", emoji: "ğŸ‘‘", rarity: "æ™®é€š", effect: "" },
        { key: "forest_warlord", name: "æ£®æ—æˆ˜ç¥", emoji: "ğŸ”¥", rarity: "ä¼ è¯´", effect: "flame" },
        { key: "lightning_reflex", name: "é—ªç”µå¿«æ‰‹", emoji: "âš¡", rarity: "ä¼ è¯´", effect: "lightning" },
        { key: "king_of_jungle", name: "æ£®æ—ä¹‹ç‹", emoji: "ğŸ‘‘", rarity: "ä¼ è¯´", effect: "sparkle" },
      ];
      let unlockedMap = {};
      fetch("/api/achievements", { credentials: "same-origin" })
        .then(function(r) {
          if (r.status === 401) { window.location.href = "/"; return; }
          return r.json();
        })
        .then(function(data) {
          if (!data) return;
          const list = (data.medal_list && data.medal_list.length) ? data.medal_list : medalList;
          const medals = data.medals || [];
          medals.forEach(function(m) { unlockedMap[m.key] = m.unlocked_at || ""; });
          grid.innerHTML = list.map(function(m) {
            const key = m.key;
            const unlocked = unlockedMap[key];
            const isUnlocked = !!unlocked;
            const dateStr = unlocked ? String(unlocked).slice(0, 10) : "";
            const rarity = m.rarity || "æ™®é€š";
            const effect = m.effect || "";
            const epicClass = effect ? " ach-slot-epic medal-epic ach-slot-" + effect : "";
            return (
              '<button type="button" class="ach-slot ' + (isUnlocked ? "ach-slot-unlocked" : "ach-slot-locked") + epicClass + '" data-key="' + key + '" data-date="' + dateStr + '" data-name="' + (m.name || key) + '" data-rarity="' + rarity + '">' +
                '<span class="ach-slot-circle">' +
                  '<span class="ach-slot-emoji">' + (m.emoji || "ğŸ…") + '</span>' +
                  (isUnlocked ? '<span class="ach-slot-glow"></span>' : '') +
                  (isUnlocked && effect ? '<span class="ach-slot-epic-effect ach-epic-' + effect + '"></span>' : '') +
                '</span>' +
                '<span class="ach-slot-name">' + (m.name || key) + '</span>' +
              '</button>'
            );
          }).join("");
          grid.querySelectorAll(".ach-slot").forEach(function(btn) {
            btn.addEventListener("click", function() {
              const date = btn.dataset.date;
              const name = btn.dataset.name;
              const rarity = btn.dataset.rarity || "æ™®é€š";
              if (rarityEl) rarityEl.textContent = "ç¨€æœ‰åº¦ï¼š" + rarity;
              if (dateEl) dateEl.textContent = date ? "è¾¾æˆæ—¥æœŸï¼š" + date : "";
              if (btn.classList.contains("ach-slot-unlocked") && date) {
                if (msgEl) msgEl.textContent = "æ­å–œï¼ä½ åœ¨ " + date + " è·å¾—äº†ã€Œ" + name + "ã€è¿™ä¸ªè£èª‰ï¼Œä½ æ˜¯æœ€æ£’çš„ï¼";
              } else if (btn.classList.contains("ach-slot-locked")) {
                if (msgEl) msgEl.textContent = "ç»§ç»­åŠ æ²¹ï¼å®Œæˆå¯¹åº”æŒ‘æˆ˜å³å¯è§£é”ã€Œ" + name + "ã€ã€‚";
              }
              modal.setAttribute("aria-hidden", "false");
              modal.classList.add("ach-modal-open");
            });
          });
        })
        .catch(function() {
          grid.innerHTML = "<p class=\"ach-empty\">è¯·å…ˆ<a href=\"/\">ç™»å½•</a>æŸ¥çœ‹å‹‹ç« </p>";
        });
      closeBtn.addEventListener("click", function() {
        modal.classList.remove("ach-modal-open");
        modal.setAttribute("aria-hidden", "true");
      });
    })();
  </script>
</body>
</html>
